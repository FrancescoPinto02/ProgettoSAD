---
output: html_notebook
---

# Perfomance dello Studente nel Primo Anno Accademico
Primo Semestre:
* Curricular units 1st sem (credited)
* Curricular units 1st sem (enrolled)
* Curricular units 1st sem (evaluations)
* Curricular units 1st sem (approved)
* Curricular units 1st sem (grade)
* Curricular units 1st sem (without evaluations)

Secondo Semestre:
* Curricular units 2nd sem (credited)
* Curricular units 2nd sem (enrolled)
* Curricular units 2nd sem (evaluations)
* Curricular units 2nd sem (approved)
* Curricular units 2nd sem (grade)
* Curricular units 2nd sem (without evaluations)

```{r setup, include=FALSE}
# Caricamento Librerie
library(ggplot2)
library(dplyr)
library(here)
library(moments)
library(patchwork)

calculate_summary_indices <- function(dataset, feature_name) {
  # Check if the feature exists in the dataset
  if (!feature_name %in% colnames(dataset)) {
    stop("The specified feature does not exist in the dataset.")
  }
  
  # Extract the specified column
  column <- dataset[[feature_name]]
  
  # Check if the column is numeric
  if (!is.numeric(column)) {
    stop("The specified feature is not numeric.")
  }
  
  # Calculate summary indices
  quantiles <- quantile(column, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
  indices <- list(
    mean = mean(column, na.rm = TRUE),
    median = median(column, na.rm = TRUE),
    standard_deviation = sd(column, na.rm = TRUE),
    variance = var(column, na.rm = TRUE),
    minimum = min(column, na.rm = TRUE),
    maximum = max(column, na.rm = TRUE),
    range = max(column, na.rm = TRUE) - min(column, na.rm = TRUE),
    IQR = quantiles[3] - quantiles[1],
    skewness = moments::skewness(column, na.rm = TRUE),
    kurtosis = moments::kurtosis(column, na.rm = TRUE),
    quantiles = quantiles
  )
  
  return(indices)
}


extract_outliers <- function(dataset, feature_name) {
  # Controlla che la feature esista nel dataset
  if (!feature_name %in% colnames(dataset)) {
    stop("The specified feature does not exist in the dataset.")
  }
  
  # Estrai la colonna specificata
  column <- dataset[[feature_name]]
  
  # Controlla che la colonna sia numerica
  if (!is.numeric(column)) {
    stop("The specified feature is not numeric.")
  }
  
  # Calcola i quantili e l'IQR
  quantiles <- quantile(column, probs = c(0.25, 0.75), na.rm = TRUE)
  Q1 <- quantiles[1]
  Q3 <- quantiles[2]
  IQR <- Q3 - Q1
  
  # Determina i limiti per gli outlier
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  
  # Identifica gli outlier
  outliers <- dataset[column < lower_bound | column > upper_bound, ]
  
  return (outliers)
}
```

## Caricamento del Dataset
```{r}
if(file.exists(here("dataset/dataMod.csv"))){
  data <- read.csv(here("dataset/dataMod.csv"), sep = ",", header = TRUE, check.names = FALSE)
  
  # Visualizza le prime righe
  head(data)
  
} else{
  print("Il dataset non è stato trovato nella directory")
}

```


## Unità Curriculari Accreditate
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_1st_sem_(credited)")
print(summary_indices)
```
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_2nd_sem_(credited)")
print(summary_indices)
```

```{r}
# istogramma CU Credited 1st sem
hist1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(credited)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "skyblue") +
  labs(title = "1°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  theme_minimal()+
  theme(plot.title = element_text(hjust = 0.5))

# Istogramma CU Credited 2nd Sem
hist2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(credited)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "orange") +
  labs(title = "2°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  theme_minimal()+
  theme(plot.title = element_text(hjust = 0.5))

hist1 + plot_spacer() + hist2 + 
  plot_layout(widths = c(1, 0.2, 1)) + 
  plot_annotation(
    title = "Distribuzione Unità Curriculari Accreditate",
    theme = theme(
      plot.title = element_text(hjust = 0.6, size = 16)
    )
  )
```

```{r}
# limiti asse X
x_limits <- range(c(data$`Curricular_units_1st_sem_(credited)`, 
                    data$`Curricular_units_2nd_sem_(credited)`), na.rm = TRUE)

# Boxplot CU Credited 1st sem
boxplot1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(credited)`, y = "")) +
  geom_boxplot(fill = "lightblue", color = "darkblue", width = 0.3) +
  labs(title = "1°- Semestre", x = "Unità Curriculari") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Boxplot CU Credited 2nd sem
boxplot2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(credited)`, y = "")) +
  geom_boxplot(fill = "lightgreen", color = "darkgreen", width = 0.3) +
  labs(title = "2°- Semestre", x = "Unità Curriculari") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1))+ 
  plot_annotation(
    title = "Boxplot Unità Curriculari Accreditate",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16)
    )
  )

```
Outliers primo semestre
```{r}
print(extract_outliers(data, "Curricular_units_1st_sem_(credited)"))
```
Outliers secondo semestre
```{r}
print(extract_outliers(data, "Curricular_units_2nd_sem_(credited)"))
```



```{r}
# Limiti asse Y
y_limits <- range(c(data$`Curricular_units_1st_sem_(credited)`, 
                    data$`Curricular_units_2nd_sem_(credited)`), na.rm = TRUE)

# Boxplot 1st sem
boxplot1 <- ggplot(data, aes(x = Target, y = `Curricular_units_1st_sem_(credited)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkblue",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "1°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Boxplot 2nd sem
boxplot2 <- ggplot(data, aes(x = Target, y = `Curricular_units_2nd_sem_(credited)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkgreen",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "2°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Combina i due boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1)) +
  plot_annotation(
    title = "Confronto CU Accreditati tra classi Target",
    theme = theme(
      plot.title = element_text(hjust = 0.52, size = 16),
    )
  )

```


## Unità Curriculari Iscritte
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_1st_sem_(enrolled)")
print(summary_indices)
```

```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_2nd_sem_(enrolled)")
print(summary_indices)
```

```{r}
# Limiti asse x
x_limits <- range(c(data$`Curricular_units_1st_sem_(enrolled)`, 
                    data$`Curricular_units_2nd_sem_(enrolled)`), na.rm = TRUE)
x_limits <- c(floor(x_limits[1]), ceiling(x_limits[2]))
x_breaks <- seq(x_limits[1], x_limits[2], by = 5)

# Istogramma CU Enrolled 1st sem
hist1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(enrolled)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "skyblue", boundary = 0) +
  labs(title = "1°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) + # Imposta i limiti calcolati
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Istogramma CU Enrolled 2nd sem
hist2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(enrolled)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "orange", boundary = 0) +
  labs(title = "2°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) + # Imposta i limiti calcolati
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Combina i grafici
hist1 + plot_spacer() + hist2 + 
  plot_layout(widths = c(1, 0.2, 1)) + 
  plot_annotation(
    title = "Distribuzione Unità Curriculari Iscritte",
    theme = theme(
      plot.title = element_text(hjust = 0.6, size = 16)
    )
  )

```

```{r}
# Determina i limiti comuni per l'asse X
x_limits <- range(c(data$`Curricular_units_1st_sem_(enrolled)`, 
                    data$`Curricular_units_2nd_sem_(enrolled)`), na.rm = TRUE)

# Boxplot CU Enrolled 1st sem
boxplot1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(enrolled)`, y = "")) +
  geom_boxplot(fill = "lightblue", color = "darkblue", width = 0.3) +
  labs(title = "1°- Semestre", x = "Unità Curriculari") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Boxplot CU Enrolled 2nd sem
boxplot2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(enrolled)`, y = "")) +
  geom_boxplot(fill = "lightgreen", color = "darkgreen", width = 0.3) +
  labs(title = "2°- Semestre", x = "Unità Curriculari") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Combina i boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1))+ 
  plot_annotation(
    title = "Boxplot Unità Curriculari Iscritte",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16)
    )
  )
```
Outliers primo semestre
```{r}
print(extract_outliers(data, "Curricular_units_1st_sem_(enrolled)"))
```
Outliers secondo semestre
```{r}
print(extract_outliers(data, "Curricular_units_2nd_sem_(enrolled)"))
```

```{r}
# Limiti asse Y
y_limits <- range(c(data$`Curricular_units_1st_sem_(enrolled)`, 
                    data$`Curricular_units_2nd_sem_(enrolled)`), na.rm = TRUE)

# Boxplot CU Enrolled 1st sem
boxplot1 <- ggplot(data, aes(x = Target, y = `Curricular_units_1st_sem_(enrolled)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkblue",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "1°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Boxplot CU Enrolled 2nd sem
boxplot2 <- ggplot(data, aes(x = Target, y = `Curricular_units_2nd_sem_(enrolled)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkgreen",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "2°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Combina i due boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1)) +
  plot_annotation(
    title = "Confronto CU Iscritti tra classi Target",
    theme = theme(
      plot.title = element_text(hjust = 0.52, size = 16),
    )
  )

```

## Valutazioni Ricevute
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_1st_sem_(evaluations)")
print(summary_indices)
```

```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_2nd_sem_(evaluations)")
print(summary_indices)
```

```{r}
# Limiti asse x
x_limits <- range(c(data$`Curricular_units_1st_sem_(evaluations)`, 
                    data$`Curricular_units_2nd_sem_(evaluations)`), na.rm = TRUE)
x_limits <- c(floor(x_limits[1]), ceiling(x_limits[2]))
x_breaks <- seq(x_limits[1], x_limits[2], by = 5)

# Istogramma Evaluations 1st sem
hist1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(evaluations)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "skyblue", boundary = 0) +
  labs(title = "1°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Istogramma Evaluations 2nd sem
hist2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(evaluations)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "orange", boundary = 0) +
  labs(title = "2°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Combina i grafici
hist1 + plot_spacer() + hist2 + 
  plot_layout(widths = c(1, 0.2, 1)) + 
  plot_annotation(
    title = "Distribuzione del Numero di Valutazioni Ricevute",
    theme = theme(
      plot.title = element_text(hjust = 0.55, size = 16)
    )
  )
```

```{r}
# limiti asse X
x_limits <- range(c(data$`Curricular_units_1st_sem_(evaluations)`, 
                    data$`Curricular_units_2nd_sem_(evaluations)`), na.rm = TRUE)

# Boxplot Evaluations 1st sem
boxplot1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(evaluations)`, y = "")) +
  geom_boxplot(fill = "lightblue", color = "darkblue", width = 0.3) +
  labs(title = "1°- Semestre", x = "Valutazioni") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Boxplot Evaluations 2nd sem
boxplot2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(evaluations)`, y = "")) +
  geom_boxplot(fill = "lightgreen", color = "darkgreen", width = 0.3) +
  labs(title = "2°- Semestre", x = "Valutazioni") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Combina i boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1))+ 
  plot_annotation(
    title = "Boxplot Numero di Valutazioni Ricevute",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16)
    )
  )
```
Outliers primo semestre
```{r}
print(extract_outliers(data, "Curricular_units_1st_sem_(evaluations)"))
```
Outliers secondo semestre
```{r}
print(extract_outliers(data, "Curricular_units_2nd_sem_(evaluations)"))
```

```{r}
# Limiti asse Y
y_limits <- range(c(data$`Curricular_units_1st_sem_(evaluations)`, 
                    data$`Curricular_units_2nd_sem_(evaluations)`), na.rm = TRUE)

# Boxplot Evaluations 1st sem
boxplot1 <- ggplot(data, aes(x = Target, y = `Curricular_units_1st_sem_(evaluations)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkblue",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "1°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Boxplot Evaluations 2nd sem
boxplot2 <- ggplot(data, aes(x = Target, y = `Curricular_units_2nd_sem_(evaluations)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkgreen",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "2°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Combina i due boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1)) +
  plot_annotation(
    title = "Confronto Numero di Valutazioni tra classi Target",
    theme = theme(
      plot.title = element_text(hjust = 0.52, size = 16),
    )
  )

```

## Unità Curriculari Completate
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_1st_sem_(approved)")
print(summary_indices)
```

```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_2nd_sem_(approved)")
print(summary_indices)
```

```{r}
# Limiti asse x
x_limits <- range(c(data$`Curricular_units_1st_sem_(approved)`, 
                    data$`Curricular_units_2nd_sem_(approved)`), na.rm = TRUE)
x_limits <- c(floor(x_limits[1]), ceiling(x_limits[2]))
x_breaks <- seq(x_limits[1], x_limits[2], by = 5)

# Istogramma CU Approved 1st sem
hist1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(approved)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "skyblue", boundary = 0) +
  labs(title = "1°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Istogramma CU Approved 2nd sem
hist2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(approved)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "orange", boundary = 0) +
  labs(title = "2°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Combina i grafici
hist1 + plot_spacer() + hist2 + 
  plot_layout(widths = c(1, 0.2, 1)) + 
  plot_annotation(
    title = "Distribuzione delle Unità Curriculari Completate",
    theme = theme(
      plot.title = element_text(hjust = 0.55, size = 16)
    )
  )
```

```{r}
# limiti asse X
x_limits <- range(c(data$`Curricular_units_1st_sem_(approved)`, 
                    data$`Curricular_units_2nd_sem_(approved)`), na.rm = TRUE)

# Boxplot CU Approved 1st sem
boxplot1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(approved)`, y = "")) +
  geom_boxplot(fill = "lightblue", color = "darkblue", width = 0.3) +
  labs(title = "1°- Semestre", x = "Valutazioni") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Boxplot CU Approved 2nd sem
boxplot2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(approved)`, y = "")) +
  geom_boxplot(fill = "orange", color = "darkgreen", width = 0.3) +
  labs(title = "2°- Semestre", x = "Valutazioni") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Combina i boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1))+ 
  plot_annotation(
    title = "Boxplot Unità Curriculari Completate",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16)
    )
  )
```
Outliers primo semestre
```{r}
print(extract_outliers(data, "Curricular_units_1st_sem_(approved)"))
```
Outliers secondo semestre
```{r}
print(extract_outliers(data, "Curricular_units_2nd_sem_(approved)"))
```

```{r}
# Limiti asse Y
y_limits <- range(c(data$`Curricular_units_1st_sem_(approved)`, 
                    data$`Curricular_units_2nd_sem_(approved)`), na.rm = TRUE)

# Boxplot CU Approved 1st sem
boxplot1 <- ggplot(data, aes(x = Target, y = `Curricular_units_1st_sem_(approved)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkblue",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "1°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Boxplot CU Approved 2nd sem
boxplot2 <- ggplot(data, aes(x = Target, y = `Curricular_units_2nd_sem_(approved)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkgreen",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "2°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Combina i due boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1)) +
  plot_annotation(
    title = "Confronto CU Completate tra classi Target",
    theme = theme(
      plot.title = element_text(hjust = 0.52, size = 16),
    )
  )

```

## Votazioni
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_1st_sem_(grade)")
print(summary_indices)
```

```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_2nd_sem_(grade)")
print(summary_indices)
```

```{r}
# Limiti asse x
x_limits <- range(c(data$`Curricular_units_1st_sem_(grade)`, 
                    data$`Curricular_units_2nd_sem_(grade)`), na.rm = TRUE)
x_limits <- c(floor(x_limits[1]), ceiling(x_limits[2]))
x_breaks <- seq(x_limits[1], x_limits[2], by = 5)

# Istogramma CU Grade 1st sem
hist1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(grade)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "skyblue", boundary = 0) +
  labs(title = "1°- Semestre",
       x = "Voto Medio",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Istogramma CU Grade 2nd sem
hist2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(grade)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "orange", boundary = 0) +
  labs(title = "2°- Semestre",
       x = "Voto Medio",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Combina i grafici
hist1 + plot_spacer() + hist2 + 
  plot_layout(widths = c(1, 0.2, 1)) + 
  plot_annotation(
    title = "Distribuzione Delle Votazioni Medie",
    theme = theme(
      plot.title = element_text(hjust = 0.55, size = 16)
    )
  )
```

```{r}
# limiti asse X
x_limits <- range(c(data$`Curricular_units_1st_sem_(grade)`, 
                    data$`Curricular_units_2nd_sem_(grade)`), na.rm = TRUE)

# Boxplot CU Grade 1st sem
boxplot1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(grade)`, y = "")) +
  geom_boxplot(fill = "lightblue", color = "darkblue", width = 0.3) +
  labs(title = "1°- Semestre", x = "Valutazioni") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Boxplot CU Grade 2nd sem
boxplot2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(grade)`, y = "")) +
  geom_boxplot(fill = "orange", color = "darkgreen", width = 0.3) +
  labs(title = "2°- Semestre", x = "Valutazioni") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Combina i boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1))+ 
  plot_annotation(
    title = "Boxplot Votazioni Medie",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16)
    )
  )
```
Outliers primo semestre
```{r}
out1 = extract_outliers(data, "Curricular_units_1st_sem_(grade)")
print(out1)
```
Outliers secondo semestre
```{r}
out2 = extract_outliers(data, "Curricular_units_2nd_sem_(grade)")
print(out2)
```

```{r}
# Limiti asse Y
y_limits <- range(c(data$`Curricular_units_1st_sem_(grade)`, 
                    data$`Curricular_units_2nd_sem_(grade)`), na.rm = TRUE)

# Boxplot CU Grade 1st sem
boxplot1 <- ggplot(data, aes(x = Target, y = `Curricular_units_1st_sem_(grade)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkblue",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "1°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Boxplot CU Grade 2nd sem
boxplot2 <- ggplot(data, aes(x = Target, y = `Curricular_units_2nd_sem_(grade)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkgreen",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "2°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Combina i due boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1)) +
  plot_annotation(
    title = "Confronto Votazioni Medie tra classi Target",
    theme = theme(
      plot.title = element_text(hjust = 0.52, size = 16),
    )
  )


```

## Unità Curriculari Senza Valutazione (Idoneità)
```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_1st_sem_(without_evaluations)")
print(summary_indices)
```

```{r}
summary_indices <- calculate_summary_indices(data, "Curricular_units_2nd_sem_(without_evaluations)")
print(summary_indices)
```

```{r}
# Limiti asse x
x_limits <- range(c(data$`Curricular_units_1st_sem_(without_evaluations)`, 
                    data$`Curricular_units_2nd_sem_(without_evaluations)`), na.rm = TRUE)
x_limits <- c(floor(x_limits[1]), ceiling(x_limits[2]))
x_breaks <- seq(x_limits[1], x_limits[2], by = 5)

# Istogramma CU Without Evaluations 1st sem
hist1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(without_evaluations)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "skyblue", boundary = 0) +
  labs(title = "1°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Istogramma CU Without Evaluations 2nd sem
hist2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(without_evaluations)`)) +
  geom_histogram(binwidth = 1, color = "black", fill = "orange", boundary = 0) +
  labs(title = "2°- Semestre",
       x = "Unità Curriculari",
       y = "Frequenza Assoluta") +
  scale_x_continuous(limits = x_limits, breaks = x_breaks) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5))

# Combina i grafici
hist1 + plot_spacer() + hist2 + 
  plot_layout(widths = c(1, 0.2, 1)) + 
  plot_annotation(
    title = "Distribuzione Delle Unita Curriculari Senza Valutazione",
    theme = theme(
      plot.title = element_text(hjust = 0.55, size = 16)
    )
  )
```

```{r}
# limiti asse X
x_limits <- range(c(data$`Curricular_units_1st_sem_(without_evaluations)`, 
                    data$`Curricular_units_2nd_sem_(without_evaluations)`), na.rm = TRUE)

# Boxplot CU Without Evaluations 1st sem
boxplot1 <- ggplot(data, aes(x = `Curricular_units_1st_sem_(without_evaluations)`, y = "")) +
  geom_boxplot(fill = "lightblue", color = "darkblue", width = 0.3) +
  labs(title = "1°- Semestre", x = "Unità Curriculari") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Boxplot CU Without Evaluations 2nd sem
boxplot2 <- ggplot(data, aes(x = `Curricular_units_2nd_sem_(without_evaluations)`, y = "")) +
  geom_boxplot(fill = "orange", color = "darkgreen", width = 0.3) +
  labs(title = "2°- Semestre", x = "Unità Curriculari") +
  theme_minimal() +
  stat_boxplot(geom = "errorbar", width = 0.15) +
  scale_x_continuous(limits = x_limits) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    plot.title = element_text(hjust = 0.5)
  )

# Combina i boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1))+ 
  plot_annotation(
    title = "Boxplot Unità Curriculari Senza Valutazione",
    theme = theme(
      plot.title = element_text(hjust = 0.5, size = 16)
    )
  )
```
Outliers primo semestre
```{r}
out1 = extract_outliers(data, "Curricular_units_1st_sem_(without_evaluations)")
print(out1)
```
Outliers secondo semestre
```{r}
out2 = extract_outliers(data, "Curricular_units_2nd_sem_(without_evaluations)")
print(out2)
```

```{r}
# Limiti asse Y
y_limits <- range(c(data$`Curricular_units_1st_sem_(without_evaluations)`, 
                    data$`Curricular_units_2nd_sem_(without_evaluations)`), na.rm = TRUE)

# Boxplot CU Without Evaluations 1st sem
boxplot1 <- ggplot(data, aes(x = Target, y = `Curricular_units_1st_sem_(without_evaluations)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkblue",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "1°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Boxplot CU Without Evaluations 2nd sem
boxplot2 <- ggplot(data, aes(x = Target, y = `Curricular_units_2nd_sem_(without_evaluations)`, fill = Target)) +
  geom_boxplot(
    notch = FALSE,
    outlier.color = "darkgreen",
    outlier.shape = 1,
    width = 0.6
  ) +
  stat_boxplot(geom = "errorbar", width = 0.2, color = "black") +
  labs(
    title = "2°- Semestre",
    x = "Target",
    y = "Unità Curriculari"
  ) +
  scale_y_continuous(limits = y_limits) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "none"
  )

# Combina i due boxplot
boxplot1 + plot_spacer() + boxplot2 + 
  plot_layout(widths = c(1, 0.2, 1)) +
  plot_annotation(
    title = "Confronto CU Senza Valutazione tra classi Target",
    theme = theme(
      plot.title = element_text(hjust = 0.52, size = 16),
    )
  )

```




###Alcuni controlli sugli studenti con dati mancanti
```{r}
students_without_enrolledCU <- subset(data, `Curricular_units_1st_sem_(enrolled)` == 0 & `Curricular_units_2nd_sem_(enrolled)` == 0)
print(students_without_enrolledCU)
```
```{r}
students_without_evaluation <- subset(data, `Curricular_units_1st_sem_(evaluations)` == 0 & `Curricular_units_2nd_sem_(evaluations)` == 0)
students_without_evaluation <- subset(students_without_evaluation, `Curricular_units_1st_sem_(enrolled)` != 0 | `Curricular_units_2nd_sem_(enrolled)` != 0)
print(students_without_evaluation)
```

```{r}
students_without_grade <- subset(data, `Curricular_units_1st_sem_(grade)` == 0 & `Curricular_units_2nd_sem_(grade)` == 0)
students_without_grade <- subset(students_without_grade, `Curricular_units_1st_sem_(enrolled)` != 0 | `Curricular_units_2nd_sem_(enrolled)` != 0)
students_without_grade <- subset(students_without_grade, `Curricular_units_1st_sem_(evaluations)` != 0 | `Curricular_units_2nd_sem_(evaluations)` != 0)
print(students_without_grade)
```